"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8630],{8630:(U,F,p)=>{p.r(F),p.d(F,{PatientModule:()=>_});var b=p(6814),y=p(3699),g=p(5861),A=p(5619),o=p(6689),S=p(3970),c=p(9810);const V=["search"];function I(a,f){if(1&a){const u=o.EpF();o.TgZ(0,"ion-card",5),o.NdJ("click",function(){const r=o.CHM(u).$implicit,i=o.oxw();return o.KtG(i.navigate(r.userId))}),o.TgZ(1,"ion-card-content")(2,"ion-row")(3,"ion-col",6),o._uU(4),o.qZA()()()()}if(2&a){const u=f.$implicit;o.xp6(4),o.AsE(" ",u.lastName,", ",u.givenName," ")}}let k=(()=>{var a;class f{constructor(t,n){this.router=t,this.pouchService=n,this.mothersSubject=new A.X([]),this.results=[]}ngOnInit(){}ionViewWillEnter(){this.getMothers(),this.search.setFocus()}navigate(t){localStorage.setItem("mother_userId",t),this.router.navigate(["/admin/patient/details"])}handleInput(t){const n=t.target.value.toLowerCase();this.mothersSubject.subscribe(r=>{this.results=r.filter(i=>{if(i.lastName)return i.lastName.toLowerCase().indexOf(n)>-1})})}getMothers(){var t=this;return(0,g.Z)(function*(){try{const{docs:n}=yield t.pouchService.allMothersDb.find({selector:{roles:{$in:["mother"]}}}),r=n.map(i=>({id:i._id,lastName:i.lastName,givenName:i.givenName,userId:i.userId}));t.mothersSubject.next(r)}catch(n){console.log(n)}})()}}return(a=f).\u0275fac=function(t){return new(t||a)(o.Y36(y.F0),o.Y36(S.M))},a.\u0275cmp=o.Xpm({type:a,selectors:[["app-search"]],viewQuery:function(t,n){if(1&t&&o.Gf(V,5),2&t){let r;o.iGM(r=o.CRH())&&(n.search=r.first)}},decls:11,vars:3,consts:[["slot","start"],[1,"ion-padding",3,"fixed"],[3,"debounce","ionInput"],["search",""],[3,"click",4,"ngFor","ngForOf"],[3,"click"],["size","12",1,"d-flex","ion-align-items-center","ion-justify-content-start","ion-no-padding"]],template:function(t,n){1&t&&(o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),o._UZ(3,"ion-back-button"),o.qZA(),o.TgZ(4,"ion-title"),o._uU(5,"Search Patient"),o.qZA()()(),o.TgZ(6,"ion-content")(7,"ion-grid",1)(8,"ion-searchbar",2,3),o.NdJ("ionInput",function(i){return n.handleInput(i)}),o.qZA(),o.YNc(10,I,5,2,"ion-card",4),o.qZA()()),2&t&&(o.xp6(7),o.Q6J("fixed",!0),o.xp6(1),o.Q6J("debounce",1e3),o.xp6(2),o.Q6J("ngForOf",n.results))},dependencies:[b.sg,c.Sm,c.PM,c.FN,c.wI,c.W2,c.jY,c.Gu,c.Nd,c.VI,c.wd,c.sr,c.j9,c.oU]}),f})();var v=p(9739),Z=p(2548);const B=["foodVitABarChartCanvas"],T=["foodIronBarChartCanvas"],M=["suppVitABarChartCanvas"],O=["suppIronBarChartCanvas"],D=["vitaVsDoughnutCanvas"],N=["ironVsDoughnutCanvas"];function x(a,f){if(1&a&&(o.TgZ(0,"ion-title"),o._uU(1),o.ALo(2,"async"),o.qZA()),2&a){const u=o.oxw();o.xp6(1),o.hij("Hello, ",o.lcZ(2,1,u.givenName$),"")}}const w=[{path:"",component:(()=>{var a;class f{constructor(t,n,r){this.router=t,this.pouchService=n,this.loadingService=r,this.schedToday="ini",this.givenNameSubject=new A.X(""),this.givenName$=this.givenNameSubject.asObservable()}ngOnInit(){var t=this;return(0,g.Z)(function*(){console.log("init firing"),t.loadingService.show();try{yield t.pouchService.iniLocalDb()}catch(n){console.error("Error during initialization:",n)}finally{yield t.getGivenName(),yield t.loadFeed(),t.loadingService.hide()}})()}ionViewWillEnter(){return(0,g.Z)(function*(){})()}loadFeed(){var t=this;return(0,g.Z)(function*(){let n=yield t.getChartData();n.food&&(t.setSourceOfVitAFromFoods(),t.setSourceOfIronFromFoods()),n.supp&&(t.setSourceOfVitAFromSupp(),t.setSourceOfIronFromSupp()),(n.food||n.supp)&&(t.setVitaVs(),t.setIronVs())})()}navigate(){this.router.navigate(["/admin/patient/search"])}getGivenName(){var t=this;return(0,g.Z)(function*(){for(;;){try{var{givenName:n}=yield t.pouchService.adminRndDb.get(localStorage.getItem("selected_admin"));if(null!==n){t.givenNameSubject.next(n);break}}catch(r){console.log(r)}yield t.delay(1e3)}})()}delay(t){return(0,g.Z)(function*(){return new Promise(n=>setTimeout(n,t))})()}getChartData(){var t=this;return(0,g.Z)(function*(){let n={food:!1,supp:!1};try{const i=["food","snack","drink"],{docs:h}=yield t.pouchService.allConsDb.find({selector:{$and:[{validated:!0},{subtype:{$in:i}}]}}),{docs:m}=yield t.pouchService.allConsDb.find({selector:{$and:[{validated:!0},{subtype:"supplement"}]}});if(h.length>0){n.food=!0;let d=[];for(var r=0;r<h.length;r++){let e=d.findIndex(({food:s})=>s.toUpperCase()==h[r].consumptionName.toUpperCase());e>-1?d[e].count=d[e].count+h[r].retinolAmt:d.push({order:0,food:h[r].consumptionName,count:h[r].retinolAmt})}d=d.sort(function(e,s){return s.count-e.count}),d.splice(5),d.map(e=>(e.order=d.indexOf(e)+1,e)),t.rankedFoodVitA=d;let l=[];for(r=0;r<h.length;r++){let s=l.findIndex(({food:C})=>C.toUpperCase()==h[r].consumptionName.toUpperCase());s>-1?l[s].count=l[s].count+h[r].ironAmt:l.push({order:0,food:h[r].consumptionName,count:h[r].ironAmt})}l=l.sort(function(e,s){return s.count-e.count}),l.splice(5),l.map(e=>(e.order=l.indexOf(e)+1,e)),t.rankedFoodIron=l,t.foodVitATotal=h.reduce((e,s)=>e+s.retinolAmt,0),t.foodIronTotal=h.reduce((e,s)=>e+s.ironAmt,0)}else console.log("No food/snack/drink consumption docs found");if(m.length>0){n.supp=!0;let d=[];for(r=0;r<m.length;r++){let s=d.findIndex(({food:C})=>C.toUpperCase()==m[r].consumptionName.toUpperCase());s>-1?d[s]=d[s]+m[r].retinolAmt:d.push({order:0,food:m[r].consumptionName,count:m[r].retinolAmt})}d=d.sort(function(e,s){return s.count-e.count}),d.splice(5),d.map(e=>(e.order=d.indexOf(e)+1,e)),t.rankedSuppVitA=d;let l=[];for(r=0;r<m.length;r++){let s=l.findIndex(({food:C})=>C.toUpperCase()==m[r].consumptionName.toUpperCase());s>-1?l[s]=l[s]+m[r].ironAmt:l.push({order:0,food:m[r].consumptionName,count:m[r].ironAmt})}l=l.sort(function(e,s){return s.count-e.count}),l.splice(5),l.map(e=>(e.order=l.indexOf(e)+1,e)),t.rankedSuppIron=l,t.suppVitATotal=m.reduce((e,s)=>e+s.retinolAmt,0),t.suppIronTotal=m.reduce((e,s)=>e+s.ironAmt,0)}else console.log("No supplement consumption docs found");return n}catch(i){return console.log(i),n}})()}handleRefresh(t){var n=this;return(0,g.Z)(function*(){setTimeout((0,g.Z)(function*(){yield n.pouchService.iniLocalDb();const r=yield n.getChartData();r.food&&(n.updateChartData(n.foodVitABarChart,n.rankedFoodVitA.map(i=>i.food),n.rankedFoodVitA.map(i=>i.count)),n.updateChartData(n.foodIronBarChart,n.rankedFoodIron.map(i=>i.food),n.rankedFoodIron.map(i=>i.count))),r.supp&&(n.updateChartData(n.suppVitABarChart,n.rankedSuppVitA.map(i=>i.food),n.rankedSuppVitA.map(i=>i.count)),n.updateChartData(n.suppIronBarChart,n.rankedSuppIron.map(i=>i.food),n.rankedSuppIron.map(i=>i.count))),(r.food||r.supp)&&(n.updateChartData(n.vitaVsDoughnut,["Food","Supplement"],[n.foodVitATotal,n.suppVitATotal]),n.updateChartData(n.ironVsDoughnut,["Food","Supplement"],[n.foodIronTotal,n.suppIronTotal])),t.target.complete()}),2e3)})()}setSourceOfVitAFromFoods(){this.foodVitABarChart=new v.kL(this.foodVitABarChartCanvas.nativeElement,{type:"bar",data:{labels:this.rankedFoodVitA.map(t=>t.food),datasets:[{label:"Source of Vit A from Foods",data:this.rankedFoodVitA.map(t=>t.count),backgroundColor:["rgba(255, 159, 64, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)"],hoverBackgroundColor:["#FFCE56","#FF6384","#36A2EB","#FFCE56","#FF6384"]}]},options:{indexAxis:"y",plugins:{title:{display:!0,text:"Source of Vit A from Foods"},legend:{display:!1}}}})}updateChartData(t,n,r){t.data.labels=n,t.data.datasets[0].data=r,t.update()}setSourceOfIronFromFoods(){this.foodIronBarChart=new v.kL(this.foodIronBarChartCanvas.nativeElement,{type:"bar",data:{labels:this.rankedFoodIron.map(t=>t.food),datasets:[{label:"Source of Iron from Foods",data:this.rankedFoodIron.map(t=>t.count),backgroundColor:["rgba(255, 159, 64, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)"],hoverBackgroundColor:["#FFCE56","#FF6384","#36A2EB","#FFCE56","#FF6384"]}]},options:{indexAxis:"y",plugins:{title:{display:!0,text:"Source of Iron from Foods"},legend:{display:!1}}}})}setSourceOfVitAFromSupp(){this.suppVitABarChart=new v.kL(this.suppVitABarChartCanvas.nativeElement,{type:"bar",data:{labels:this.rankedSuppVitA.map(t=>t.food),datasets:[{label:"Source of Vit A from Supplements",data:this.rankedSuppVitA.map(t=>t.count),backgroundColor:["rgba(255, 159, 64, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)"],hoverBackgroundColor:["#FFCE56","#FF6384","#36A2EB","#FFCE56","#FF6384"]}]},options:{indexAxis:"y",plugins:{title:{display:!0,text:"Source of Vit A from Supplements"},legend:{display:!1}}}})}setSourceOfIronFromSupp(){this.suppIronBarChart=new v.kL(this.suppIronBarChartCanvas.nativeElement,{type:"bar",data:{labels:this.rankedSuppIron.map(t=>t.food),datasets:[{label:"Source of Iron from Supplements",data:this.rankedSuppIron.map(t=>t.count),backgroundColor:["rgba(255, 159, 64, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)"],hoverBackgroundColor:["#FFCE56","#FF6384","#36A2EB","#FFCE56","#FF6384"]}]},options:{indexAxis:"y",plugins:{title:{display:!0,text:"Source of Iron from Supplements"},legend:{display:!1}}}})}setVitaVs(){this.vitaVsDoughnut=new v.kL(this.vitaVsDoughnutCanvas.nativeElement,{type:"doughnut",data:{labels:["Food","Supplement"],datasets:[{label:"Vitamin A amount in mg",data:[this.foodVitATotal,this.suppVitATotal],backgroundColor:["rgba(255, 159, 64, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)"],hoverBackgroundColor:["#FFCE56","#FF6384","#36A2EB","#FFCE56","#FF6384"]}]},options:{plugins:{title:{display:!0,text:"Source of Vit A (Food vs Supplements)"},legend:{display:!1}}}})}setIronVs(){this.ironVsDoughnut=new v.kL(this.ironVsDoughnutCanvas.nativeElement,{type:"doughnut",data:{labels:["Food","Supplement"],datasets:[{label:"Iron amount in mg",data:[this.foodIronTotal,this.suppIronTotal],backgroundColor:["rgba(255, 159, 64, 0.2)","rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)"],hoverBackgroundColor:["#FFCE56","#FF6384","#36A2EB","#FFCE56","#FF6384"]}]},options:{plugins:{title:{display:!0,text:"Source of Iron (Food vs Supplements)"},legend:{display:!1}}}})}}return(a=f).\u0275fac=function(t){return new(t||a)(o.Y36(y.F0),o.Y36(S.M),o.Y36(Z.b))},a.\u0275cmp=o.Xpm({type:a,selectors:[["app-home"]],viewQuery:function(t,n){if(1&t&&(o.Gf(B,5),o.Gf(T,5),o.Gf(M,5),o.Gf(O,5),o.Gf(D,5),o.Gf(N,5)),2&t){let r;o.iGM(r=o.CRH())&&(n.foodVitABarChartCanvas=r.first),o.iGM(r=o.CRH())&&(n.foodIronBarChartCanvas=r.first),o.iGM(r=o.CRH())&&(n.suppVitABarChartCanvas=r.first),o.iGM(r=o.CRH())&&(n.suppIronBarChartCanvas=r.first),o.iGM(r=o.CRH())&&(n.vitaVsDoughnutCanvas=r.first),o.iGM(r=o.CRH())&&(n.ironVsDoughnutCanvas=r.first)}},decls:38,vars:9,consts:[[4,"ngIf"],["placeholder","Search Patient",3,"click"],["slot","fixed",3,"ionRefresh"],[3,"hidden"],[2,"position","relative","height","20vh","width","40vw"],["foodVitABarChartCanvas",""],["foodIronBarChartCanvas",""],["suppVitABarChartCanvas",""],["suppIronBarChartCanvas",""],["vitaVsDoughnutCanvas",""],["ironVsDoughnutCanvas",""]],template:function(t,n){1&t&&(o.TgZ(0,"ion-header")(1,"ion-toolbar"),o.YNc(2,x,3,3,"ion-title",0),o.ALo(3,"async"),o.qZA()(),o.TgZ(4,"ion-searchbar",1),o.NdJ("click",function(){return n.navigate()}),o.qZA(),o.TgZ(5,"ion-content")(6,"ion-refresher",2),o.NdJ("ionRefresh",function(i){return n.handleRefresh(i)}),o._UZ(7,"ion-refresher-content"),o.qZA(),o.TgZ(8,"div",3)(9,"ion-card")(10,"ion-card-content"),o._UZ(11,"canvas",4,5),o.qZA()()(),o.TgZ(13,"div",3)(14,"ion-card")(15,"ion-card-content"),o._UZ(16,"canvas",4,6),o.qZA()()(),o.TgZ(18,"div",3)(19,"ion-card")(20,"ion-card-content"),o._UZ(21,"canvas",4,7),o.qZA()()(),o.TgZ(23,"div",3)(24,"ion-card")(25,"ion-card-content"),o._UZ(26,"canvas",4,8),o.qZA()()(),o.TgZ(28,"div",3)(29,"ion-card")(30,"ion-card-content"),o._UZ(31,"canvas",4,9),o.qZA()()(),o.TgZ(33,"div",3)(34,"ion-card")(35,"ion-card-content"),o._UZ(36,"canvas",4,10),o.qZA()()()()),2&t&&(o.xp6(2),o.Q6J("ngIf",o.lcZ(3,7,n.givenName$)),o.xp6(6),o.Q6J("hidden",!n.foodVitABarChart),o.xp6(5),o.Q6J("hidden",!n.foodIronBarChart),o.xp6(5),o.Q6J("hidden",!n.suppVitABarChart),o.xp6(5),o.Q6J("hidden",!n.suppIronBarChart),o.xp6(5),o.Q6J("hidden",!n.vitaVsDoughnut),o.xp6(5),o.Q6J("hidden",!n.ironVsDoughnut))},dependencies:[b.O5,c.PM,c.FN,c.W2,c.Gu,c.nJ,c.Wo,c.VI,c.wd,c.sr,c.j9,b.Ov],styles:['@font-face{font-family:Open Sans;src:url(OpenSans-VariableFont_wdth,wght.abb0f3a06e9f64d3.ttf) format("truetype-variations");font-weight:1 999}[_ngcontent-%COMP%]:root{--ion-color-primary: #226747;--ion-color-primary-rgb: 34,103,71;--ion-color-primary-contrast: #ffffff;--ion-color-primary-contrast-rgb: 255,255,255;--ion-color-primary-shade: #1e5b3e;--ion-color-primary-tint: #387659;--ion-color-secondary: #eb7e9b;--ion-color-secondary-rgb: 235,126,155;--ion-color-secondary-contrast: #000000;--ion-color-secondary-contrast-rgb: 0,0,0;--ion-color-secondary-shade: #cf6f88;--ion-color-secondary-tint: #ed8ba5;--ion-color-tertiary: #feeff3;--ion-color-tertiary-rgb: 254,239,243;--ion-color-tertiary-contrast: #000000;--ion-color-tertiary-contrast-rgb: 0,0,0;--ion-color-tertiary-shade: #e0d2d6;--ion-color-tertiary-tint: #fef1f4;--ion-color-success: #41c767;--ion-color-success-rgb: 65,199,103;--ion-color-success-contrast: #000000;--ion-color-success-contrast-rgb: 0,0,0;--ion-color-success-shade: #39af5b;--ion-color-success-tint: #54cd76;--ion-color-warning: #f0a73a;--ion-color-warning-rgb: 240,167,58;--ion-color-warning-contrast: #000000;--ion-color-warning-contrast-rgb: 0,0,0;--ion-color-warning-shade: #d39333;--ion-color-warning-tint: #f2b04e;--ion-color-danger: #d66554;--ion-color-danger-rgb: 214,101,84;--ion-color-danger-contrast: #000000;--ion-color-danger-contrast-rgb: 0,0,0;--ion-color-danger-shade: #bc594a;--ion-color-danger-tint: #da7465;--ion-color-dark: #222428;--ion-color-dark-rgb: 34, 36, 40;--ion-color-dark-contrast: #ffffff;--ion-color-dark-contrast-rgb: 255, 255, 255;--ion-color-dark-shade: #1e2023;--ion-color-dark-tint: #383a3e;--ion-color-medium: #92949c;--ion-color-medium-rgb: 146, 148, 156;--ion-color-medium-contrast: #ffffff;--ion-color-medium-contrast-rgb: 255, 255, 255;--ion-color-medium-shade: #808289;--ion-color-medium-tint: #9d9fa6;--ion-color-light: #f4f5f8;--ion-color-light-rgb: 244, 245, 248;--ion-color-light-contrast: #000000;--ion-color-light-contrast-rgb: 0, 0, 0;--ion-color-light-shade: #d7d8da;--ion-color-light-tint: #f5f6f9;--ion-toolbar-background: white;--ion-toolbar-border-color: white;--ion-toolbar-color: var(--ion-color-primary-shade);--ion-tab-bar-background: var(--ion-color-secondary);--ion-tab-bar-border-color: var(--ion-color-secondary-tint);--ion-tab-bar-color: var(--ion-color-secondary-shade);--ion-tab-bar-color-selected: var(--ion-color-primary);--ion-item-background: var(--ion-color-tertiary);--ion-item-border-color: var(--ion-color-tertiary);--color: var(--ion-color-dark);--ion-item-color: var(--ion-color-dark);--ion-card-color: var(--ion-color-dark);--ion-font-family: "Open Sans";--border-color: yellow}ion-select[_ngcontent-%COMP%], ion-radio[_ngcontent-%COMP%], ion-input[_ngcontent-%COMP%] > label[_ngcontent-%COMP%]{color:var(--ion-color-dark)}ion-icon[name=eye-outline][_ngcontent-%COMP%], ion-icon[name=eye-off-outline][_ngcontent-%COMP%]{color:var(--ion-color-dark);position:absolute;z-index:2;right:1.2em}.checkbox-icon[_ngcontent-%COMP%]{background:black!important}html[_ngcontent-%COMP%]{--ion-dynamic-font: var(--ion-default-dynamic-font);font-family:var(--ion-font-family)}.color-primary[_ngcontent-%COMP%]{background:var(--ion-color-primary-tint)}.color-secondary[_ngcontent-%COMP%]{background:var(--ion-color-secondary)}.color-tertiary[_ngcontent-%COMP%]{background:var(--ion-color-tertiary-tint)}.table-header[_ngcontent-%COMP%]{font-weight:700!important}']}),f})()},{path:"search",component:k},{path:"details",loadChildren:()=>Promise.all([p.e(8906),p.e(5176)]).then(p.bind(p,5176)).then(a=>a.DetailsModule)}];let E=(()=>{var a;class f{}return(a=f).\u0275fac=function(t){return new(t||a)},a.\u0275mod=o.oAB({type:a}),a.\u0275inj=o.cJS({imports:[y.Bz.forChild(w),y.Bz]}),f})();var P=p(95);let _=(()=>{var a;class f{}return(a=f).\u0275fac=function(t){return new(t||a)},a.\u0275mod=o.oAB({type:a}),a.\u0275inj=o.cJS({imports:[b.ez,E,c.Pc,P.UX]}),f})()}}]);